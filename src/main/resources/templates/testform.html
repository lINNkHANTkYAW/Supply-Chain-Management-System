<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Product Form</title>
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<style>
/* Style for the Product Table */
.table {
	width: 100%;
	border-collapse: collapse;
	margin-top: 20px;
}

.table th, .table td {
	padding: 10px;
	text-align: left;
	border: 1px solid #ddd;
}

.table th {
	background-color: #f2f2f2;
}

/* Styling the Edit and Delete forms */
form {
	display: inline-block;
}

/* Edit Button */
.btn-warning {
	background-color: #ffc107;
	color: white;
	border: none;
	padding: 8px 16px;
	cursor: pointer;
	border-radius: 5px;
	transition: background-color 0.3s ease;
}

.btn-warning:hover {
	background-color: #e0a800;
}

/* Delete Button */
.btn-danger {
	background-color: #dc3545;
	color: white;
	border: none;
	padding: 8px 16px;
	cursor: pointer;
	border-radius: 5px;
	transition: background-color 0.3s ease;
}

.btn-danger:hover {
	background-color: #c82333;
}

/* Input fields within the form */
input[type="text"], input[type="number"], input[type="file"] {
	padding: 5px;
	margin: 5px 0;
	width: 100%;
	border: 1px solid #ccc;
	border-radius: 4px;
}

input[type="text"]:focus, input[type="number"]:focus, input[type="file"]:focus
	{
	border-color: #66afe9;
	outline: none;
}

/* Margin between buttons */
form button {
	margin-top: 10px;
}

/* Responsive adjustments for small screens */
@media ( max-width : 768px) {
	.table th, .table td {
		font-size: 14px;
		padding: 8px;
	}
	form input {
		width: 100%;
	}
}
</style>
<body>
	<div class="container mt-5">
		<h2>Add New Product</h2>

		<form th:action="@{/api/products_management}" method="post"
			th:object="${newProduct}" enctype="multipart/form-data" >
			<input type="hidden" th:field="*{productId}" />

			<div class="form-group">
				<label for="name">Product Name</label> <input type="text"
					class="form-control" id="name" th:field="*{name}" required />
			</div>

			<div class="form-group">
				<label for="description">Description</label>
				<textarea class="form-control" id="description"
					th:field="*{description}" required></textarea>
			</div>

			<div class="form-group">
				<label for="imageFile">Image</label> <input type="file"
					class="form-control" id="imageFile" name="imageFile"
					accept=".jpg, .png, .jpeg" required />
			</div>

			<div class="form-group">
				<label for="price">Price</label> <input type="number"
					class="form-control" id="price" th:field="*{price}" step="0.01"
					required />
			</div>

			<div class="form-group">
				<label for="stockQuantity">Quantity</label> <input type="number"
					class="form-control" id="stockQuantity" th:field="*{stockQuantity}"
					required />
			</div>

			<!-- Add Category Dropdown -->
			<div class="form-group">
				<label for="categoryId">Category</label> <select
					class="form-control" id="categoryId" name="categoryId" required>
					<option value="1">Fashion and Apparel</option>
					<option value="2">Household Items</option>
					<option value="3">Food and Beverages</option>
				</select>
			</div>

			<input type="hidden" th:field="*{distributor.distributorId}"
				th:value="${distributor.distributorId}" />

			<button type="submit" class="btn btn-primary">Add Product</button>
			<a href="#" class="btn btn-secondary">Cancel</a>
		</form>

		<h3>Existing Products</h3>
		<table class="table">
			<thead>
				<tr>
					<th>ID</th>
					<th>Name</th>
					<th>Description</th>
					<th>Price</th>
					<th>Quantity</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="product : ${products}">
					<td th:text="${product.productId}"></td>
					<td th:text="${product.name}"></td>
					<td th:text="${product.description}"></td>
					<td th:text="${product.price}"></td>
					<td th:text="${product.stockQuantity}"></td>
					<td>
					<td>
						
						<form
							th:action="@{/api/products_management/edit/{productId}(productId=${product.productId})}"
							method="post" enctype="multipart/form-data">
							<input type="hidden" name="_method" value="PUT" /> <input
								type="text" name="name" th:value="${product.name}" /> <input
								type="text" name="description" th:value="${product.description}" />

							<div class="form-group">
								<label for="categoryId">Category</label> <select
									class="form-control" id="categoryId" name="categoryId" required>
									<option th:each="category : ${categories}"
										th:value="${category.categoryId}" th:text="${category.categoryName}"
										th:selected="${category.categoryId == product.category.categoryId}">
									</option>
								</select>
							</div>

							<input type="number" name="price" th:value="${product.price}" />
							<input type="number" name="stockQuantity"
								th:value="${product.stockQuantity}" /> <input type="file"
								name="imageFile" accept=".jpg, .png, .jpeg" />
							<button type="submit" class="btn btn-warning">Edit</button>
						</form>

					</td>
					<td>
						
						<form
							th:action="@{/api/products_management/delete/{productId}(productId=${product.productId})}"
							method="post">
							<input type="hidden" name="_method" value="DELETE" />
							<button type="submit" class="btn btn-danger">Delete</button>
						</form>
					</td>
					</td>

				</tr>
			</tbody> 
		</table>
	</div>

	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
	<script
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<script>
	document.addEventListener("DOMContentLoaded", function() {
	    const productForm = document.getElementById("productForm");

	    productForm.addEventListener("submit", function(event) {
	        event.preventDefault(); // Prevent the default form submission

	        const formData = new FormData(productForm);

	        fetch('/api/products_management', { // Use the correct endpoint for adding products
	            method: 'POST',
	            body: formData
	        })
	        .then(response => {
	            if (!response.ok) {
	                throw new Error("Error adding product");
	            }
	            return response.json(); // Assuming the server returns the new product data
	        })
	        .then(newProduct => {
	            // Update the product list dynamically
	            addProductToTable(newProduct);
	            // Optionally, reset the form
	            productForm.reset();
	        })
	        .catch(error => console.error("Error:", error));
	    });
	});

	// Function to add the new product to the table
	function addProductToTable(product) {
	    const tableBody = document.querySelector("tbody");
	    const newRow = document.createElement("tr");
	    newRow.innerHTML = `
	        <td>${product.productId}</td>
	        <td>${product.name}</td>
	        <td>${product.description}</td>
	        <td>${product.price}</td>
	        <td>${product.stockQuantity}</td>
	        <td>
	            <img src="${product.image}" alt="Product Image" style="height: 50px; width: auto;" />
	        </td>
	        <td>
	            <form th:action="@{/api/products_management/edit/{productId}(productId=${product.productId})}" method="post" enctype="multipart/form-data">
	                <input type="hidden" name="_method" value="PUT" />
	                <input type="text" name="name" value="${product.name}" />
	                <input type="text" name="description" value="${product.description}" />
	                <input type="number" name="price" value="${product.price}" />
	                <input type="number" name="stockQuantity" value="${product.stockQuantity}" />
	                <input type="file" name="imageFile" accept=".jpg, .png, .jpeg" />
	                <button type="submit" class="btn btn-warning">Edit</button>
	            </form>
	        </td>
	        <td>
	            <form th:action="@{/api/products_management/delete/{productId}(productId=${product.productId})}" method="post">
	                <input type="hidden" name="_method" value="DELETE" />
	                <button type="submit" class="btn btn-danger">Delete</button>
	            </form>
	        </td>
	    `;
	    tableBody.appendChild(newRow);
	}
	</script>
</body>
</html>
