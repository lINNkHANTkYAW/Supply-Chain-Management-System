<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
   <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">  
   <link rel="stylesheet" href="css/supplierdashboard.css">
   <link rel="stylesheet" href="css/forall.css">
   <title>Responsive sidebar Menu | Dark/Light Mode - Bedimcode</title>
</head>
<body>
   <header class="header" id="header">
      <div class="header__container">
         <div class="header__logo d-flex align-items-center">
            <div class="dropdown mx-3">
               <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                 <i class="bi bi-envelope"></i>
               </a>
               <ul class="dropdown-menu">
                 <li><a class="dropdown-item" href="#">Message 1</a></li>
                 <li><a class="dropdown-item" href="#">Message 2</a></li>
                 <li><a class="dropdown-item" href="#">Message 3</a></li>
               </ul>
            </div>
            <div class="dropdown mx-2">
               <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                 <i class="bi bi-bell"></i>
               </a>
               <ul class="dropdown-menu">
                 <li><a class="dropdown-item" href="#">Notification 1</a></li>
                 <li><a class="dropdown-item" href="#">Notification 2</a></li>
                 <li><a class="dropdown-item" href="#">Notification 3</a></li>
               </ul>
            </div>
        
         </div>
         <button class="header__toggle" id="header-toggle">
            <i class="ri-menu-line"></i>
         </button>
      </div>
   </header>

   <nav class="sidebar" id="sidebar">
      <div class="sidebar__container">
         <div class="sidebar__user">
            <div class="sidebar__img">
               <img src="img/perfil.png" alt="image">
            </div>
            <div class="sidebar__info">
               <h3>Rix Methil</h3>
               <span><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2f1d06175e5d5c2f0a020e0603410c0002">[emailÂ protected]</a></span>
            </div>
         </div>
         <div class="sidebar__content">
            <div>
                <h3 class="sidebar__title">MANAGE</h3>
                <div class="sidebar__list">
                   <a href="distributordashboard.html" class="sidebar__link">
                      <i class="ri-pie-chart-2-fill"></i>
                      <span>Dashboard</span>
                   </a>
                   <a href="distributormanageproduct.html" class="sidebar__link">
                      <i class="bi bi-inboxes-fill"></i>
                      <span>Manage Product</span>
                   </a>
                   <a href="distributormanageinventory.html" class="sidebar__link active-link">
                      <i class="bi bi-boxes"></i>
                      <span>Manage Inventory</span>
                   </a>
                   <a href="distributormanufacturermarketplace.html" class="sidebar__link">
                     <i class="bi bi-shop"></i>
                      <span>Manufactuerer MarketPlace</span>
                   </a>
                   <a href="distributororderfrommanufacturer.html" class="sidebar__link">
                      <i class="ri-arrow-up-down-line"></i>
                      <span>Orders History with Manufactuerer</span>
                   </a>
                   <a href="distributororderfromcustomer.html" class="sidebar__link">
                      <i class="bi bi-journal-check"></i>
                      <span>Orders from Customer</span>
                   </a>
                   <a href="distributoranalytics.html" class="sidebar__link">
                      <i class="bi bi-bar-chart-line"></i>
                      <span>Analytics</span>
                   </a>
                   <a href="distributortransaction.html" class="sidebar__link">
                      <i class="bi bi-wallet"></i>
                      <span>Transaction History</span>
                   </a>
                </div>
             </div>
            <div>
               <h3 class="sidebar__title">SETTINGS</h3>
               <div class="sidebar__list">
                  <a href="#" class="sidebar__link">
                     <i class="ri-settings-3-fill"></i>
                     <span>Settings</span>
                  </a>
                  <a href="#" class="sidebar__link">
                     <i class="ri-mail-unread-fill"></i>
                     <span>My Messages</span>
                  </a>
                  <a href="#" class="sidebar__link">
                     <i class="ri-notification-2-fill"></i>
                     <span>Notifications</span>
                  </a>
               </div>
            </div>
         </div>
         <div class="sidebar__actions">
            <button>
               <i class="ri-moon-clear-fill sidebar__link sidebar__theme" id="theme-button">
                  <span>Theme</span>
               </i>
            </button>
            <button class="sidebar__link">
               <i class="ri-logout-box-r-fill"></i>
               <span>Log Out</span>
            </button>
         </div>
      </div>
   </nav>

   <main class="main container-fluid" id="main">
     <h3>Delivered Items</h3>
     <table class="table table-striped" id="deliveredItemsTable">
         <thead>
             <tr>
                 <th>Item Name</th>
                 <th>Quantity</th>
                 <th>Cost</th>
                 <th>Added Date</th>
                 <th>Actions</th>
             </tr>
         </thead>
         <tbody></tbody>
     </table>
 
     <h3 class="mt-4">Add Items to Inventory</h3>
     <table class="table table-striped" id="inventoryItemsTable">
         <thead>
             <tr>
                 <th>Item Name</th>
                 <th>Quantity</th>
                 <th>Cost</th>
                 <th>Cost Per Unit</th>
                 <th>Added Date</th>
                 <th>Actions</th>
             </tr>
         </thead>
         <tbody></tbody>
     </table>
     <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addItemModal">Add New Item</button>
   </main>

   <div class="modal fade" id="addItemModal" tabindex="-1" aria-labelledby="addItemModalLabel" aria-hidden="true">
       <div class="modal-dialog">
           <div class="modal-content">
               <div class="modal-header">
                   <h5 class="modal-title" id="addItemModalLabel">Add/Edit Item</h5>
                   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                   <form id="itemForm">
                       <input type="hidden" id="itemId" />
                       <div class="mb-3">
                           <label for="itemName" class="form-label">Item Name</label>
                           <input type="text" class="form-control" id="itemName" required>
                       </div>
                       <div class="mb-3">
                           <label for="itemQuantity" class="form-label">Quantity</label>
                           <input type="number" class="form-control" id="itemQuantity" required>
                       </div>
                       <div class="mb-3">
                           <label for="itemCost" class="form-label">Cost</label>
                           <input type="number" class="form-control" id="itemCost" required>
                       </div>
                       <div class="mb-3">
                           <label for="itemCostPerUnit" class="form-label">Cost Per Unit</label>
                           <input type="number" class="form-control" id="itemCostPerUnit" required>
                       </div>
                       <div class="mb-3">
                           <label for="itemAddedDate" class="form-label">Added Date</label>
                           <input type="date" class="form-control" id="itemAddedDate" required>
                       </div>
                       <button type="submit" class="btn btn-primary">Save Item</button>
                   </form>
               </div>
           </div>
       </div>
   </div>

   <script src="js/forall.js"></script>
   <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>  
   <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>  
   <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <script>
     const distributorId = 1;

     window.onload = () => {
         fetchDeliveredItems();
         fetchInventoryItems();
     };

     function fetchDeliveredItems() {
         fetch(`/api/delivered-items?distributorId=${distributorId}`)
             .then(response => response.json())
             .then(data => {
                 const tableBody = document.querySelector('#deliveredItemsTable tbody');
                 tableBody.innerHTML = '';
                 data.forEach(item => {
                     const row = document.createElement('tr');
                     row.innerHTML = `
                         <td>${item.name}</td>
                         <td>${item.quantity}</td>
                         <td>${item.cost}</td>
                         <td>${item.addedDate}</td>
                         <td>
                             <button class="btn btn-warning btn-sm" onclick="editItem(${item.id}, 'delivered')">Edit</button>
                             <button class="btn btn-danger btn-sm" onclick="deleteItem(${item.id}, 'delivered')">Delete</button>
                         </td>
                     `;
                     tableBody.appendChild(row);
                 });
             })
             .catch(error => console.error('Error fetching delivered items:', error));
     }

     function fetchInventoryItems() {
         fetch(`/api/inventory-items?distributorId=${distributorId}`)
             .then(response => response.json())
             .then(data => {
                 const tableBody = document.querySelector('#inventoryItemsTable tbody');
                 tableBody.innerHTML = '';
                 data.forEach(item => {
                     const row = document.createElement('tr');
                     row.innerHTML = `
                         <td>${item.name}</td>
                         <td>${item.quantity}</td>
                         <td>${item.cost}</td>
                         <td>${item.costPerUnit}</td>
                         <td>${item.addedDate}</td>
                         <td>
                             <button class="btn btn-warning btn-sm" onclick="editItem(${item.id}, 'inventory')">Edit</button>
                             <button class="btn btn-danger btn-sm" onclick="deleteItem(${item.id}, 'inventory')">Delete</button>
                         </td>
                     `;
                     tableBody.appendChild(row);
                 });
             })
             .catch(error => console.error('Error fetching inventory items:', error));
     }

     function editItem(itemId, type) {
         const url = type === 'delivered' ? `/api/delivered-items/${itemId}` : `/api/item/${itemId}`; // Updated URL
         fetch(url)
             .then(response => {
                 if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                 return response.json();
             })
             .then(item => {
                 document.getElementById('itemId').value = item.id;
                 document.getElementById('itemName').value = item.name;
                 document.getElementById('itemQuantity').value = item.quantity;
                 document.getElementById('itemCost').value = item.cost;
                 document.getElementById('itemCostPerUnit').value = item.costPerUnit || '';
                 document.getElementById('itemAddedDate').value = item.addedDate.split('T')[0];
                 // Explicitly show the modal
                 const modal = new bootstrap.Modal(document.getElementById('addItemModal'));
                 modal.show();
             })
             .catch(error => console.error('Error fetching item details:', error));
     }

     document.getElementById('itemForm').addEventListener('submit', function (event) {
         event.preventDefault();
         const itemId = document.getElementById('itemId').value;
         const item = {
             name: document.getElementById('itemName').value,
             quantity: document.getElementById('itemQuantity').value,
             cost: document.getElementById('itemCost').value,
             costPerUnit: document.getElementById('itemCostPerUnit').value,
             addedDate: document.getElementById('itemAddedDate').value
         };

         let url = `/api/inventory-items?distributorId=${distributorId}`;
         let method = 'POST';

         if (itemId) {
             url = `/api/inventory-items/${itemId}?distributorId=${distributorId}`;
             method = 'PUT';
         }

         fetch(url, {
             method: method,
             headers: {
                 'Content-Type': 'application/json'
             },
             body: JSON.stringify(item)
         })
             .then(response => response.json())
             .then(data => {
                 const modal = bootstrap.Modal.getInstance(document.getElementById('addItemModal'));
                 modal.hide();
                 fetchInventoryItems();
             })
             .catch(error => console.error('Error saving item:', error));
     });

     function deleteItem(itemId, type) {
         if (confirm('Are you sure you want to delete this item?')) {
             const url = type === 'delivered' ? `/api/delivered-items/${itemId}` : `/api/inventory-items/${itemId}`;
             fetch(url, {
                 method: 'DELETE'
             })
                 .then(response => {
                     if (response.ok) {
                         if (type === 'delivered') fetchDeliveredItems();
                         else fetchInventoryItems();
                     } else {
                         console.error('Error deleting item');
                     }
                 })
                 .catch(error => console.error('Error deleting item:', error));
         }
     }
   </script>
</body>
</html>