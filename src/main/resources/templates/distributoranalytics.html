<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--=============== REMIXICONS ===============-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">  

    <!--=============== CSS ===============-->
    <link rel="stylesheet" th:href="@{/css/supplieranalytics.css}">
    <link rel="stylesheet" th:href="@{/css/forall.css}">

    <title>Manufacturer Analytics Dashboard</title>
</head>
<body>
    <!--=============== HEADER ===============-->
    <header class="header" id="header">
        <div class="header__container">
            <div class="header__logo d-flex align-items-center">
                <!-- Message Box Dropdown -->
                <div class="dropdown mx-3">
                    <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-envelope"></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li th:each="message : ${messages}">
                            <a class="dropdown-item" th:href="@{/messages/{id}(id=${message.id})}" 
                               th:text="${message.title}">Message</a>
                        </li>
                        <li th:unless="${#lists.isEmpty(messages)}">
                            <a class="dropdown-item" href="#">No new messages</a>
                        </li>
                    </ul>
                </div>

                <!-- Notification Bell Dropdown -->
                <div class="dropdown mx-2">
                    <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-bell"></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li th:each="notification : ${notifications}">
                            <a class="dropdown-item" th:href="@{/notifications/{id}(id=${notification.id})}" 
                               th:text="${notification.title}">Notification</a>
                        </li>
                        <li th:unless="${#lists.isEmpty(notifications)}">
                            <a class="dropdown-item" href="#">No new notifications</a>
                        </li>
                    </ul>
                </div>

            </div>
            <button class="header__toggle" id="header-toggle">
                <i class="ri-menu-line"></i>
            </button>
        </div>
    </header>

    <!--=============== SIDEBAR ===============-->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar__container">
            <div class="sidebar__user">
                <div class="sidebar__img">
                    <img th:src="${user.profileImg} ?: '/img/perfil.png'" alt="Profile image">
                </div>
                <div class="sidebar__info">
                    <h3 th:text="${user.username}">Rix Methil</h3>
                    <span th:text="${user.email}">rix123@email.com</span>
                </div>
            </div>

            <div class="sidebar__content">
                <div>
                    <h3 class="sidebar__title">MANAGE</h3>
                    <div class="sidebar__list">
                        <a th:href="@{/distributor-dashboard}" class="sidebar__link">
                            <i class="ri-pie-chart-2-fill"></i>
                            <span>Dashboard</span>
                        </a>
                        <a th:href="@{/manufacturer/manage-product}" class="sidebar__link">
                            <i class="bi bi-inboxes-fill"></i>
                            <span>Manage Product</span>
                        </a>
                        <a th:href="@{/manufacturer/manage-inventory}" class="sidebar__link">
                            <i class="bi bi-boxes"></i>
                            <span>Manage Inventory</span>
                        </a>
                        <a th:href="@{/manufacturermarketplace}" class="sidebar__link">
                            <i class="bi bi-shop"></i>
                            <span>Manufacturer Marketplace</span>
                        </a>
                        <a th:href="@{/manufacturer/orders}" class="sidebar__link">
                            <i class="ri-arrow-up-down-line"></i>
                            <span>Order History</span>
                        </a>
                        <a th:href="@{/distributoranalytics}" class="sidebar__link active-link">
                            <i class="bi bi-bar-chart-line"></i>
                            <span>Analytics</span>
                        </a>
                        <a th:href="@{/manufacturer/transactions}" class="sidebar__link">
                            <i class="bi bi-wallet"></i>
                            <span>Transaction History</span>
                        </a>
                    </div>
                </div>
                <div>
                    <h3 class="sidebar__title">SETTINGS</h3>
                    <div class="sidebar__list">
                        <a th:href="@{/settings}" class="sidebar__link">
                            <i class="ri-settings-3-fill"></i>
                            <span>Settings</span>
                        </a>
                        <a th:href="@{/messages}" class="sidebar__link">
                            <i class="ri-mail-unread-fill"></i>
                            <span>My Messages</span>
                        </a>
                        <a th:href="@{/notifications}" class="sidebar__link">
                            <i class="ri-notification-2-fill"></i>
                            <span>Notifications</span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="sidebar__actions">
                <button>
                    <i class="ri-moon-clear-fill sidebar__link sidebar__theme" id="theme-button">
                        <span>Theme</span>
                    </i>
                </button>
                <button class="sidebar__link" th:onclick="@{/logout}">
                    <i class="ri-logout-box-r-fill"></i>
                    <span>Log Out</span>
                </button>
            </div>
        </div>
    </nav>

    <!--=============== MAIN ===============-->
    <main class="main container-fluid" id="main">
        <h1 class="text-center mb-4">Manufacturer Analytics</h1>

        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card card-custom text-white mb-3" style="background-image: linear-gradient(230deg, #fc5286, #fbaaa2);">
                    <div class="card-body">
                        <h5 class="card-title">Total Products Sold</h5>
                        <p class="card-text fs-4" th:text="${totalProductsSold}">5,500</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-custom text-white mb-3" style="background-image: linear-gradient(230deg, #759bff, #843cf6);">
                    <div class="card-body">
                        <h5 class="card-title">Revenue</h5>
                        <p class="card-text fs-4" th:text="'$' + ${totalRevenue}">120,000</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-custom text-white mb-3" style="background-image: linear-gradient(230deg, #ffc480, #ff763b);">
                    <div class="card-body">
                        <h5 class="card-title">Satisfaction Rate</h5>
                        <p class="card-text fs-4" th:text="${satisfactionRate} + '%'">87</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-custom text-white mb-3" style="background-image: linear-gradient(230deg, #0e4cfd, #6a8eff);">
                    <div class="card-body">
                        <h5 class="card-title">Pending Orders</h5>
                        <p class="card-text fs-4" th:text="${pendingOrders}">45</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card card-custom mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Monthly Product Sales</h5>
                        <div class="chart-container">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card card-custom mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Revenue Distribution</h5>
                        <div class="chart-container">
                            <canvas id="revenuePieChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card card-custom mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Top Distributors by Revenue</h5>
                        <div class="chart-container">
                            <canvas id="topSupplierChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card card-custom mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Order Completion Rate</h5>
                        <div class="chart-container">
                            <canvas id="completionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card card-custom mt-4">
            <div class="card-body">
                <h5 class="card-title">Distributor Performance Data</h5>
                <table class="table table-hover table-custom">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Distributor Name</th>
                            <th>Orders Fulfilled</th>
                            <th>Total Revenue</th>
                            <th>Performance Rating</th>
                            <th>Contact Email</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="perf, iterStat : ${performanceData}">
                            <td th:text="${iterStat.count}">1</td>
                            <td th:text="${perf.distributorName}">Global Supply Co.</td>
                            <td th:text="${perf.ordersFulfilled}">500</td>
                            <td th:text="'$' + ${perf.totalRevenue}">50,000</td>
                            <td th:text="${perf.performanceRating}">Excellent</td>
                            <td th:text="${perf.contactEmail}">global@suppliers.com</td>
                        </tr>
                        <tr th:unless="${#lists.isEmpty(performanceData)}">
                            <td colspan="6" class="text-center">No performance data available.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!--=============== MAIN JS ===============-->
    <script th:src="@{/js/forall.js}"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:inline="javascript">
        // Pass server-side data to JavaScript
        const monthlySales = /*[[${monthlySales}]]*/ [];
        const revenueDistribution = /*[[${revenueDistribution}]]*/ [];
        const topDistributors = /*[[${topDistributors}]]*/ [];
        const orderCompletion = /*[[${orderCompletion}]]*/ [];

        // Line Chart - Monthly Sales
        const salesChartCtx = document.getElementById('salesChart').getContext('2d');
        new Chart(salesChartCtx, {
            type: 'line',
            data: {
                labels: monthlySales.map(item => item.month),
                datasets: [{
                    label: 'Sales',
                    data: monthlySales.map(item => item.sales),
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: true } }
            }
        });

        // Pie Chart - Revenue Distribution
        const revenuePieCtx = document.getElementById('revenuePieChart').getContext('2d');
        new Chart(revenuePieCtx, {
            type: 'pie',
            data: {
                labels: revenueDistribution.map(item => item.supplierName),
                datasets: [{
                    data: revenueDistribution.map(item => item.revenue),
                    backgroundColor: ['rgba(255, 99, 132, 0.8)', 'rgba(54, 162, 235, 0.8)', 'rgba(255, 206, 86, 0.8)', 'rgba(75, 192, 192, 0.8)']
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'top' } }
            }
        });

        // Bar Chart - Top Distributors
        const topSupplierCtx = document.getElementById('topSupplierChart').getContext('2d');
        new Chart(topSupplierCtx, {
            type: 'bar',
            data: {
                labels: topDistributors.map(item => item.supplierName),
                datasets: [{
                    label: 'Revenue ($)',
                    data: topDistributors.map(item => item.revenue),
                    backgroundColor: 'rgba(153, 102, 255, 0.8)'
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: true } }
            }
        });

        // Doughnut Chart - Order Completion
        const completionCtx = document.getElementById('completionChart').getContext('2d');
        new Chart(completionCtx, {
            type: 'doughnut',
            data: {
                labels: orderCompletion.map(item => item.status),
                datasets: [{
                    data: orderCompletion.map(item => item.count),
                    backgroundColor: ['rgba(75, 192, 192, 0.8)', 'rgba(255, 99, 132, 0.8)']
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'top' } }
            }
        });
    </script>
</body>
</html>